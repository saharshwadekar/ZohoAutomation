from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.action_chains import ActionChains
import time
import schedule
import pytz
from datetime import datetime
import os
from selenium.webdriver.chrome.service import Service
from webdriver_manager.chrome import ChromeDriverManager

# Replace these with your Zoho login credentials
ZOHO_EMAIL = 'your_email@example.com'
ZOHO_PASSWORD = 'your_password'

# Define your Zoho login URL
ZOHO_LOGIN_URL = 'https://accounts.zoho.com/signin'

# Setup ChromeDriver (Automatically installs if not available)
def get_driver():
    options = webdriver.ChromeOptions()
    options.add_argument("--headless")  # Run browser in background (optional)
    options.add_argument("--disable-gpu")
    options.add_argument("--no-sandbox")
    
    # Automatically download the correct driver version using webdriver-manager
    driver = webdriver.Chrome(service=Service(ChromeDriverManager().install()), options=options)
    return driver

# Function to login to Zoho portal
def login_to_zoho(driver):
    driver.get(ZOHO_LOGIN_URL)
    time.sleep(2)  # Wait for page to load

    # Find the login fields and enter credentials
    email_field = driver.find_element(By.ID, "login_id")
    password_field = driver.find_element(By.ID, "password")

    email_field.send_keys(ZOHO_EMAIL)
    password_field.send_keys(ZOHO_PASSWORD)
    
    # Submit the form
    password_field.send_keys(Keys.RETURN)
    time.sleep(5)  # Wait for login to complete

    # Handle possible two-factor authentication or any login redirections here if needed

    print("Successfully logged in!")

# Function to perform check-in at 9:45 AM IST
def check_in(driver):
    # Navigate to the Zoho check-in page (you will need the actual URL here)
    driver.get('https://your_zoho_checkin_url')  # Change with actual check-in URL

    time.sleep(2)  # Wait for the page to load

    # Find and click the check-in button (you need to inspect and get the right button)
    checkin_button = driver.find_element(By.ID, 'checkin_button')  # Change with actual element ID
    checkin_button.click()

    print(f"Check-in successful at {datetime.now(pytz.timezone('Asia/Kolkata'))}")

# Function to perform check-out at 7:45 PM IST
def check_out(driver):
    # Navigate to the Zoho check-out page (you will need the actual URL here)
    driver.get('https://your_zoho_checkout_url')  # Change with actual check-out URL

    time.sleep(2)  # Wait for the page to load

    # Find and click the check-out button (you need to inspect and get the right button)
    checkout_button = driver.find_element(By.ID, 'checkout_button')  # Change with actual element ID
    checkout_button.click()

    print(f"Check-out successful at {datetime.now(pytz.timezone('Asia/Kolkata'))}")

# Function to perform login and check-in
def task_check_in():
    driver = get_driver()
    login_to_zoho(driver)
    check_in(driver)
    driver.quit()

# Function to perform login and check-out
def task_check_out():
    driver = get_driver()
    login_to_zoho(driver)
    check_out(driver)
    driver.quit()

# Function to schedule tasks
def schedule_tasks():
    # Convert 9:45 AM IST to local time
    schedule.every().day.at("09:45").do(task_check_in)
    schedule.every().day.at("19:45").do(task_check_out)
    
    print("Scheduled tasks for Check-in and Check-out")
    while True:
        schedule.run_pending()
        time.sleep(1)

# Main function
if __name__ == '__main__':
    schedule_tasks()
